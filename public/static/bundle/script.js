(()=>{"use strict";var t=function(){function t(t,e,s){this.$Nav=t,this.state=e,this.props=s,this.$NavContainer=this.$Nav.querySelector(".page-nav-tab"),this.$NavAddButton=this.$Nav.querySelector(".add-tab-button"),this.$NavAddButton.addEventListener("click",this.props.addNewPage),this.setState(e)}return t.prototype.setState=function(t){this.state=t,this.render()},t.prototype.render=function(){var t=this,e=this.state,s=e.pageList,o=e.selectedPageId;this.$NavContainer.innerHTML="\n    ".concat(s.map((function(t,e){return"<div class='tab ".concat(o===t.id?"selected":"","'>\n        ").concat(t.page_name,'\n        <div class="tab-delete-button" id="').concat(t.id,'">🗑</div>\n        </div>')})).join(""),"\n    "),this.$Nav.querySelectorAll(".tab").forEach((function(e){var s=e.childNodes[1];s.addEventListener("click",(function(e){e.stopPropagation(),t.props.deletePage(Number(s.id))})),e.addEventListener("click",(function(e){e.stopPropagation(),t.props.clickPageTab(Number(s.id))}))}))},t}();const e=t;var s="page_list",o="postit_page";function i(t,e){var s=JSON.stringify(e);localStorage.setItem(t,s)}function n(t){return JSON.parse(localStorage.getItem(t))}function a(t){if("postit-delete-button"!==t.target.className){document.addEventListener("mousemove",r);var e=t.target.parentElement,s=document.querySelectorAll(".postit"),o=e.classList;if(!o.contains("hold")){var i=t.clientX,n=t.clientY,a=e.getBoundingClientRect(),d=i-a.x,c=n-a.y;e.setAttribute("gap-x",String(d)),e.setAttribute("gap-y",String(c));var p=String((s.length>0?Math.max.apply(null,Array.from(s).map((function(t){return Number(t.getAttribute("priority"))}))):9999)+1);e.setAttribute("priority",p),e.style.zIndex=p,o.add("hold")}}}function r(t){t.preventDefault();var e=document.querySelector(".postit.hold");if(e){var s=t.clientX,o=t.clientY,i=e.getAttribute("gap-x"),n=e.getAttribute("gap-y"),a=s-Number(i),r=o-Number(n);e.style.left=a+"px",e.style.top=r+"px"}}const d=function(){function t(t,e,s){var o,i,n,a=this;this.setState=function(t){a.state=t,a.props.setBgColor(a.state)},this.$ProgressToggle=t,this.state=e,this.props=s,null===(o=this.$ProgressToggle)||void 0===o||o.addEventListener("mousedown",(function(t){return t.stopPropagation()})),null===(i=this.$ProgressToggle)||void 0===i||i.addEventListener("mouseup",(function(t){return t.stopPropagation()})),null===(n=this.$ProgressToggle)||void 0===n||n.addEventListener("change",(function(t){var e;return a.setState(null===(e=a.$ProgressToggle)||void 0===e?void 0:e.value)}))}return t.prototype.render=function(){},t}(),c=function(){function t(t,e){var s=t.postit_id,o=t.contents,i=void 0===o?"":o,n=t.status,a=void 0===n?"todo":n,r=t.pos_X,c=t.pos_Y,p=this;this.dbClickPostit=function(t){var e,s=t.target,o=null===(e=s.parentElement)||void 0===e?void 0:e.querySelector(".postit-contents-form");s.style.display="none",o.style.display="",null==o||o.focus(),null==o||o.addEventListener("focusout",(function(t){s.style.display="",o.style.display="none",p.setContetns(o.value)}))},this.setContetns=function(t){p.$PostItContents.innerHTML="".concat(t),p.state.contents=t,p.props.updatePostit(p.state.postit_id)},this.setBgColor=function(t){p.$Postit.style.backgroundColor={1:"#fff6c1",2:"#94dbc5",3:"#bdcfe4"}[t]},this.state={postit_id:s,contents:i,status:a,pos_X:r,pos_Y:c},this.props=e,this.$Postit=document.createElement("div"),this.$Postit.classList.add("postit"),this.$Postit.id=String(s),this.$Postit.style.left=r+"px",this.$Postit.style.top=c+"px",this.$Postit.innerHTML='\n      <div class="postit-top-area">\n        <input\n          class="process-toggle-button"\n          type="range"\n          id="RangeFilter"\n          min="1"\n          max="3"\n          value="1"\n          style=""\n        />\n        <div class="postit-delete-button">🗑</div>\n      </div>\n      <div class="postit-contents-area">'.concat(i,'</div>\n      <textarea class="postit-contents-form" value="').concat(i,'" style="display: none;"></textarea>\n    '),this.$PostItContents=this.$Postit.querySelector(".postit-contents-area"),this.$PostItForm=this.$Postit.querySelector(".postit-contents-form"),this.$PostItForm.value=i,this.$PostItContents.addEventListener("dblclick",this.dbClickPostit),this.dbClickPostit=this.dbClickPostit.bind(this),this.setContetns=this.setContetns.bind(this),this.$PostItDeleteButton=this.$Postit.querySelector(".postit-delete-button"),this.$PostItDeleteButton.addEventListener("mouseup",(function(t){return t.stopPropagation()})),this.$PostItDeleteButton.addEventListener("click",(function(t){t.stopPropagation(),p.props.deletePostit(t,p.state.postit_id)})),this.processToggle=new d(this.$Postit.querySelector(".process-toggle-button"),this.state.status,{setBgColor:this.setBgColor})}return t.prototype.setState=function(){this.render()},t.prototype.getState=function(){},t.prototype.render=function(){this.$Postit},t}();var p=function(){function t(t,e,s){var n=this;this.postitList=[],this.postitLastId=1,this.deletePostit=function(t,e){t.stopPropagation(),t.preventDefault();var s=n.postitList.findIndex((function(t){return t.state.postit_id===e}));-1!==s&&n.postitList.splice(s,1)[0].$Postit.remove(),i("".concat(o,"_").concat(n.state.selectedPageId),n.postitList)},this.$Page=t,this.state=e,this.props=s,this.addNewPostIt=this.addNewPostIt.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.updatePostit=this.updatePostit.bind(this),this.setState=this.setState.bind(this),this.$PostItContainer=this.$Page.querySelector(".postit-container"),this.$PostItBody=this.$Page.querySelector(".postit-body"),document.addEventListener("dragstart",(function(t){t.dataTransfer.setData("startX","".concat(t.clientX-22)),t.dataTransfer.setData("startY","".concat(t.clientY-74))})),document.addEventListener("dragover",(function(t){return t.preventDefault()})),document.addEventListener("drop",this.addNewPostIt);var a=this.state.selectedPageId;this.fetchData(a),this.setState(e)}return t.prototype.fetchData=function(t){var e=this,s=n("".concat(o,"_").concat(t));s||(i("".concat(o,"_").concat(t),[]),s=[]),this.postitList=s.map((function(t){return t.state.postit_id>e.postitLastId&&(e.postitLastId=t.state.postit_id),new c({postit_id:t.state.postit_id,status:t.state.status,contents:t.state.contents,pos_X:t.state.pos_X,pos_Y:t.state.pos_Y},{updatePostit:e.updatePostit,deletePostit:e.deletePostit})}))},t.prototype.setState=function(t){this.state=t,this.fetchData(this.state.selectedPageId),this.render()},t.prototype.addNewPostIt=function(t){var e=t.clientX,s=t.clientY,n=Number(t.dataTransfer.getData("startX")),a=Number(t.dataTransfer.getData("startY")),r=new c({postit_id:(this.postitLastId+=1,this.postitLastId),pos_X:e-n,pos_Y:s-a},{updatePostit:this.updatePostit,deletePostit:this.deletePostit});this.postitLastId=this.postitList.push(r),i("".concat(o,"_").concat(this.state.selectedPageId),this.postitList),this.setState(this.state)},t.prototype.render=function(){var t=this;this.$PostItBody.innerHTML="",this.postitList.forEach((function(e,s){t.$PostItBody.appendChild(e.$Postit)})),this.drowPostit()},t.prototype.drowPostit=function(){var t=this;document.querySelectorAll(".postit").forEach((function(e,s){var o=e.getAttribute("priority");o||(o=s+1,e.setAttribute("priority",o)),e.style["z-index"]=o,e.addEventListener("mousedown",a),e.addEventListener("mouseup",t.handleMouseUp)}))},t.prototype.updatePostit=function(t){i("".concat(o,"_").concat(this.state.selectedPageId),this.postitList)},t.prototype.handleMouseUp=function(t){t.preventDefault();var e=t.target.parentElement,s=e.id,n=e.style,a=this.postitList.find((function(t){return t.state.postit_id===Number(s)}));if(a){a.state.pos_X=parseInt(n.left),a.state.pos_Y=parseInt(n.top),i("".concat(o,"_").concat(this.state.selectedPageId),this.postitList),document.removeEventListener("mousemove",r);var d=document.querySelector(".postit.hold");d&&(d.removeAttribute("gap-x"),d.removeAttribute("gap-y"),d.classList.remove("hold"))}},t}();const u=p;var l=function(){return l=Object.assign||function(t){for(var e,s=1,o=arguments.length;s<o;s++)for(var i in e=arguments[s])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},l.apply(this,arguments)};const h=function(t,n){var a=this;this.addNewPage=function(){var t=a.state,e=t.pageList,o=t.maxPageId,n=(a.state=l(l({},a.state),{maxPageId:o+1}),a.state.maxPageId);e.push({id:n,page_name:"untitled_".concat(n),total_count:0,todo_count:0,ing_count:0,complete_count:0}),a.state.selectedPageId=a.state.maxPageId,i(s,e),a.NavComponent.setState(a.state),a.BodyComponent.setState(a.state)},this.deletePage=function(t){var e=a.state,n=e.pageList,r=e.selectedPageId,d=n.findIndex((function(e){return e.id===t}));if(r===t){if(1===n.length)return void alert("마지막 페이지는 삭제할 수 없습니다.");a.state.selectedPageId=n[d-1].id}var c,p=n.splice(d,1)[0];i(s,n),c="".concat(o,"_").concat(p.id),localStorage.removeItem(c),a.NavComponent.setState(a.state),a.BodyComponent.setState(a.state)},this.clickPageTab=function(t){var e=l(l({},a.state),{selectedPageId:t});a.state.selectedPageId=t,a.NavComponent.setState(e),a.BodyComponent.setState(e)},this.$App=t,this.state=n,this.HeaderComponent=this.$App.querySelector(".postit-header"),this.NavComponent=new e(this.$App.querySelector(".postit-page-nav"),this.state,{addNewPage:this.addNewPage,deletePage:this.deletePage,clickPageTab:this.clickPageTab}),this.BodyComponent=new u(this.$App.querySelector(".postit-body-page"),this.state,{})};var g,v=document.querySelector(".app"),P={pageList:[]};(g=n(s))||i(s,g=[{id:1,page_name:"untitled",total_count:0,todo_count:0,ing_count:0,complete_count:0}]),P.pageList=g,P.lastPageId=g[g.length-1].id,P.selectedPageId=g[g.length-1].id,P.maxPageId=Math.max.apply(Math,g.map((function(t){return t.id}))),new h(v,P)})();