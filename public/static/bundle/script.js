(()=>{"use strict";var t=function(){function t(t,e,s){this.$Nav=t,this.state=e,this.props=s,this.$NavContainer=this.$Nav.querySelector(".page-nav-tab"),this.$NavAddButton=this.$Nav.querySelector(".add-tab-button"),this.$NavCalenderButton=this.$Nav.querySelector(".calender-button"),this.$NavAddButton.addEventListener("click",this.props.addNewPage),this.setState(e)}return t.prototype.setState=function(t){this.state=t,this.render()},t.prototype.render=function(){var t=this,e=this.state,s=e.pageList,o=e.selectedPageId;this.$NavContainer.innerHTML="\n    ".concat(s.map((function(t,e){return"<div class='tab ".concat(o===t.id?"selected":"","' id=\"").concat(t.id,'">\n        <p>').concat(t.pageName,'</p>\n        <input class="tab-name-form" style="display:none" type="text" />\n        <div class="tab-delete-button" id="').concat(t.id,'">🗑</div>\n        </div>\n        ')})).join(""),"\n    "),this.$Nav.querySelectorAll(".tab").forEach((function(e){var s=e.childNodes[1],n=e.childNodes[3],i=e.childNodes[5],a=Number(i.id);i.addEventListener("click",(function(e){e.stopPropagation(),t.props.deletePage(a)})),e.addEventListener("click",(function(e){e.stopPropagation(),o!==a&&t.props.clickPageTab(a)})),e.addEventListener("dblclick",(function(e){e.stopPropagation(),s.style.display="none",n.style.display="",null==n||n.focus(),null==n||n.addEventListener("focusout",(function(e){s.style.display="",n.style.display="none",console.log(n.value),console.log(t.state.selectedPageInfo),t.props.updateTab(a,n.value)}))})),i.addEventListener}))},t}();const e=t;var s={PAGE_LIST:"page_list",POSTIT_PAGE:"postit_page"};const o={STORAGE_KEYS:s,STATUS_TEXT:{todo:{color:"#778899",text:"TODO"},doing:{color:"#1b64de",text:"DOING.."},done:{color:"#035400",text:"DONE!"}},STATUS_CODE:{1:"todo",2:"doing",3:"done",todo:1,doing:2,done:3},STATUS_BG_COLOR:{todo:"#fff6c1",doing:"#bdcfe4",done:"#94dbc5"}};function n(t,e){var s=JSON.stringify(e);localStorage.setItem(t,s)}function i(t){return JSON.parse(localStorage.getItem(t))}function a(t){if("postit-delete-button"!==t.target.className){document.addEventListener("mousemove",r);var e=t.target.parentElement,s=document.querySelectorAll(".postit"),o=e.classList;if(!o.contains("hold")){var n=t.clientX,i=t.clientY,a=e.getBoundingClientRect(),d=n-a.x,c=i-a.y;e.setAttribute("gap-x",String(d)),e.setAttribute("gap-y",String(c));var l=String((s.length>0?Math.max.apply(null,Array.from(s).map((function(t){return Number(t.getAttribute("priority"))}))):9999)+1);e.setAttribute("priority",l),e.style.zIndex=l,o.add("hold")}}}function r(t){t.preventDefault();var e=document.querySelector(".postit.hold");if(e){var s=t.clientX,o=t.clientY,n=e.getAttribute("gap-x"),i=e.getAttribute("gap-y"),a=s-Number(n),r=o-Number(i);e.style.left=a+"px",e.style.top=r+"px"}}const d=function(t,e,s){var n,i,a,r=this;this.setState=function(t){r.state=t,r.props.setBgColor(r.state),r.props.setTextColor(r.state),r.props.updateStatus(r.state)},this.$ProgressToggle=t,this.state=e,this.props=s,this.$ProgressToggle.value=String(o.STATUS_CODE[e]),null===(n=this.$ProgressToggle)||void 0===n||n.addEventListener("mousedown",(function(t){return t.stopPropagation()})),null===(i=this.$ProgressToggle)||void 0===i||i.addEventListener("mouseup",(function(t){return t.stopPropagation()})),null===(a=this.$ProgressToggle)||void 0===a||a.addEventListener("change",(function(t){var e;return r.setState(null===(e=r.$ProgressToggle)||void 0===e?void 0:e.value)}))},c=function(){function t(t,e){var s=t.postit_id,n=t.contents,i=void 0===n?"":n,a=t.status,r=t.pos_X,c=t.pos_Y,l=this;this.dbClickPostit=function(t){var e,s=t.target,o=null===(e=s.parentElement)||void 0===e?void 0:e.querySelector(".postit-contents-form");o.style.display="",s.style.display="none",null==o||o.focus(),null==o||o.addEventListener("focusout",(function(t){s.style.display="",o.style.display="none",l.setContetns(o.value)}))},this.setContetns=function(t){l.$PostItContents.innerHTML="".concat(t),l.state.contents=t,l.props.updatePostit()},this.updateStatus=function(t){var e=o.STATUS_CODE[t];l.state.status=e,l.props.updatePostit(),l.props.reRenderPage({})},this.setBgColor=function(t){var e=o.STATUS_CODE[t];l.$Postit.style.backgroundColor=o.STATUS_BG_COLOR[e],l.props.updatePostit()},this.setTextColor=function(t){var e=o.STATUS_CODE[t];l.$PostItStatus.innerText=o.STATUS_TEXT[e].text,l.$PostItStatus.style.color=o.STATUS_TEXT[e].color},this.state={postit_id:s,contents:i,status:a,pos_X:r,pos_Y:c},this.props=e,this.$Postit=document.createElement("div"),this.$Postit.classList.add("postit"),this.$Postit.id=String(s),this.$Postit.style.left=r+"px",this.$Postit.style.top=c+"px",this.$Postit.style.background=o.STATUS_BG_COLOR[this.state.status],this.$Postit.innerHTML='\n      <div class="postit-top-area">\n        <div class="postit-status"></div>\n        <input\n          class="process-toggle-button"\n          type="range"\n          id="RangeFilter"\n          min="1"\n          max="3"\n          value="1"\n          style=""\n        />\n        <div class="postit-delete-button">🗑</div>\n      </div>\n      <pre class="postit-contents-area">'.concat(i,'</pre>\n      <textarea class="postit-contents-form" value="').concat(i,'" style="display: none;"></textarea>\n    '),this.$PostItContents=this.$Postit.querySelector(".postit-contents-area"),this.$PostItForm=this.$Postit.querySelector(".postit-contents-form"),this.$PostItForm.value=i,this.$PostItContents.addEventListener("dblclick",this.dbClickPostit),this.dbClickPostit=this.dbClickPostit.bind(this),this.setContetns=this.setContetns.bind(this),this.$PostItStatus=this.$Postit.querySelector(".postit-status"),this.$PostItStatus.innerText=o.STATUS_TEXT[this.state.status].text,this.$PostItStatus.style.color=o.STATUS_TEXT[this.state.status].color,this.$PostItDeleteButton=this.$Postit.querySelector(".postit-delete-button"),this.$PostItDeleteButton.addEventListener("mouseup",(function(t){return t.stopPropagation()})),this.$PostItDeleteButton.addEventListener("click",(function(t){t.stopPropagation(),l.props.deletePostit(t,l.state.postit_id)})),this.processToggle=new d(this.$Postit.querySelector(".process-toggle-button"),this.state.status,{setBgColor:this.setBgColor,setTextColor:this.setTextColor,updateStatus:this.updateStatus})}return t.prototype.setState=function(){this.render()},t.prototype.getState=function(){},t.prototype.render=function(){this.$Postit},t}();var l=function(){function t(t,e,o){var i=this;this.postitList=[],this.postitLastId=1,this.addNewPostIt=function(t){var e=t.clientX,o=t.clientY,a=Number(t.dataTransfer.getData("startX")),r=Number(t.dataTransfer.getData("startY")),d=new c({postit_id:(i.postitLastId+=1,i.postitLastId),status:"todo",pos_X:e-a,pos_Y:o-r},{updatePostit:i.updatePostit,deletePostit:i.deletePostit,reRenderPage:i.props.reRenderPage});i.postitLastId=i.postitList.push(d),n("".concat(s.POSTIT_PAGE,"_").concat(i.state.selectedPageId),i.postitList),i.setState(i.state),i.props.reRenderPage(i.state)},this.deletePostit=function(t,e){t.stopPropagation(),t.preventDefault();var o=i.postitList.findIndex((function(t){return t.state.postit_id===e}));-1!==o&&i.postitList.splice(o,1)[0].$Postit.remove(),n("".concat(s.POSTIT_PAGE,"_").concat(i.state.selectedPageId),i.postitList)},this.$Page=t,this.state=e,this.props=o,this.addNewPostIt=this.addNewPostIt.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.updatePostit=this.updatePostit.bind(this),this.setState=this.setState.bind(this),this.$PostItContainer=this.$Page.querySelector(".postit-container"),this.$PostItBody=this.$Page.querySelector(".postit-body"),document.addEventListener("dragstart",(function(t){t.dataTransfer.setData("startX","".concat(t.clientX-22)),t.dataTransfer.setData("startY","".concat(t.clientY-74))})),document.addEventListener("dragover",(function(t){return t.preventDefault()})),document.addEventListener("drop",this.addNewPostIt),this.setState(e)}return t.prototype.fetchData=function(t){var e=this,o=i("".concat(s.POSTIT_PAGE,"_").concat(t));o||(n("".concat(s.POSTIT_PAGE,"_").concat(t),[]),o=[]);var a=o.length,r=0,d=0;this.postitList=o.map((function(t){switch(t.state.postit_id>e.postitLastId&&(e.postitLastId=t.state.postit_id),t.state.status){case"doing":r++;break;case"done":d++}return new c({postit_id:t.state.postit_id,status:t.state.status,contents:t.state.contents,pos_X:t.state.pos_X,pos_Y:t.state.pos_Y},{updatePostit:e.updatePostit,deletePostit:e.deletePostit,reRenderPage:e.props.reRenderPage})})),this.state.selectedPageInfo.totalCount=a,this.state.selectedPageInfo.doingCount=r,this.state.selectedPageInfo.doneCount=d},t.prototype.setState=function(t){this.state=t,this.fetchData(this.state.selectedPageId),this.render()},t.prototype.render=function(){var t=this;this.$PostItBody.innerHTML="",this.postitList.forEach((function(e,s){t.$PostItBody.appendChild(e.$Postit)})),this.drowPostit()},t.prototype.drowPostit=function(){var t=this;document.querySelectorAll(".postit").forEach((function(e,s){var o=e.getAttribute("priority");o||(o=s+1,e.setAttribute("priority",o)),e.style["z-index"]=o,e.addEventListener("mousedown",a),e.addEventListener("mouseup",t.handleMouseUp)}))},t.prototype.updatePostit=function(){n("".concat(s.POSTIT_PAGE,"_").concat(this.state.selectedPageId),this.postitList)},t.prototype.handleMouseUp=function(t){t.preventDefault();var e=t.target.parentElement,o=e.id,i=e.style,a=this.postitList.find((function(t){return t.state.postit_id===Number(o)}));if(a){a.state.pos_X=parseInt(i.left),a.state.pos_Y=parseInt(i.top),n("".concat(s.POSTIT_PAGE,"_").concat(this.state.selectedPageId),this.postitList),document.removeEventListener("mousemove",r);var d=document.querySelector(".postit.hold");d&&(d.removeAttribute("gap-x"),d.removeAttribute("gap-y"),d.classList.remove("hold"))}},t}();const p=l;var u=function(){function t(t,e){var s=this;this.donePercent=0,this.doingPercent=0,this.fetchProcess=function(){var t=s.state.selectedPageInfo,e=t.totalCount,o=t.doingCount,n=t.doneCount;s.doingPercent=e?o/e*100:0,s.donePercent=e?n/e*100:0},this.setState=function(t){s.state=t,s.fetchProcess(),s.render()},this.$ProgressBar=t,this.$Doing=this.$ProgressBar.querySelector(".progress-doing"),this.$Done=this.$ProgressBar.querySelector(".progress-done"),this.$DoneRate=this.$ProgressBar.querySelector(".done-rate"),this.state=e,this.setState(e)}return t.prototype.render=function(){this.$DoneRate.innerText=Math.floor(this.donePercent)+"% 완료",this.$Doing.style.width=this.doingPercent+"%",this.$Done.style.width=this.donePercent+"%"},t}();const h=u,g=function(){var t=this;this.show=function(){t.$CalenderModal.style.display="",t.$CalenderModalDimmed.style.display=""},this.hide=function(){t.$CalenderModal.style.display="none",t.$CalenderModalDimmed.style.display="none"},this.$CalenderModal=document.querySelector(".calender-modal"),this.$CalenderModalDimmed=document.querySelector(".calender-dimmed"),this.$CalenderCloseButton=this.$CalenderModal.querySelector(".modal-close-button"),this.$CalenderModal.style.display="none",this.$CalenderModalDimmed.style.display="none",console.log("!!!",this.$CalenderCloseButton),this.$CalenderModalDimmed.addEventListener("click",this.hide),this.$CalenderCloseButton.addEventListener("click",this.hide)};var P=function(){return P=Object.assign||function(t){for(var e,s=1,o=arguments.length;s<o;s++)for(var n in e=arguments[s])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},P.apply(this,arguments)};const f=function(t,o){var i=this;this.addNewPage=function(){var t=i.state,e=t.pageList,o=t.maxPageId,a=(i.state=P(P({},i.state),{maxPageId:o+1}),i.state.maxPageId);e.push({id:a,pageName:"untitled_".concat(a),totalCount:0,doingCount:0,doneCount:0}),i.state.selectedPageId=i.state.maxPageId,n(s.PAGE_LIST,e),i.setState(i.state)},this.updateTab=function(t,e){if(e){var o=i.state.pageList.find((function(e){return e.id===t}));o.pageName=e;var a=P(P({},i.state),{selectedPageInfo:o});n(s.PAGE_LIST,i.state.pageList),i.setState(a)}},this.deletePage=function(t){var e=i.state,o=e.pageList,a=e.selectedPageId,r=o.findIndex((function(e){return e.id===t}));if(a===t){if(1===o.length)return void alert("마지막 페이지는 삭제할 수 없습니다.");i.state.selectedPageId=o[r-1].id}var d,c=o.splice(r,1)[0];n(s.PAGE_LIST,o),d="".concat(s.POSTIT_PAGE,"_").concat(c.id),localStorage.removeItem(d),i.setState(i.state)},this.clickPageTab=function(t){var e=P(P({},i.state),{selectedPageId:t,selectedPageInfo:i.state.pageList.find((function(e){return e.id===t}))});i.setState(e)},this.setState=function(t){i.state=P(P({},i.state),t),i.NavComponent.setState(i.state),i.BodyComponent.setState(i.state),i.ProgressBarComponent.setState(i.state)},this.$App=t,this.state=o,this.HeaderComponent=this.$App.querySelector(".postit-header"),this.$CalenderButton=this.$App.querySelector(".calender-button"),this.NavComponent=new e(this.$App.querySelector(".postit-page-nav"),this.state,{addNewPage:this.addNewPage,deletePage:this.deletePage,clickPageTab:this.clickPageTab,updateTab:this.updateTab}),this.BodyComponent=new p(this.$App.querySelector(".postit-body-page"),this.state,{reRenderPage:this.setState}),this.ProgressBarComponent=new h(this.$App.querySelector(".postit-progress-bar"),this.state),this.CalenderComponent=new g,this.$CalenderButton.addEventListener("click",(function(t){i.CalenderComponent.show()}))};var v,S=document.querySelector(".app"),y={pageList:[]};(v=i(s.PAGE_LIST))||n(s.PAGE_LIST,v=[{id:1,pageName:"untitled",totalCount:0,doingCount:0,doneCount:0}]),y.pageList=v,y.lastPageId=v[v.length-1].id,y.selectedPageId=v[v.length-1].id,y.selectedPageInfo=v[v.length-1],y.maxPageId=Math.max.apply(Math,v.map((function(t){return t.id}))),new f(S,y)})();